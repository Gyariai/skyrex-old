import { useEffect, useState } from "react"
import { useSelector, useDispatch } from 'react-redux'
import { set_url_params_links } from "../../_dispatch/menu"
import moment from "moment-timezone"

export const Expire = ({ status, close, email }) => {
    const dispatch = useDispatch()
    const [ active, setActive ] = useState("")
    const [ active_close, setActive_close ] = useState(false)

    const { theme } = useSelector(state => state.global)

    const close_pop = () => {
        if(active_close) {
            close()
        }
    }

    const confirm = () => {
        localStorage.setItem(moment().utc().format("YYYY-MM-DD") + email, true)
        dispatch(set_url_params_links(2))
        close()
    }
    
    useEffect(() => {
        if(status) {
            setActive("block")
        } else {
            if(active) {
                setActive("animate_close")
                setTimeout(() => {
                    setActive("none")
                }, 500)
            } else {
                setActive("none")
            }
        }
    // eslint-disable-next-line react-hooks/exhaustive-deps
    }, [status])

    return (
        <div 
            className={`${"expire_popup"} ${active}`} 
            style={{ background: theme === "light" ? "rgba(255, 255, 255, 0.8)" : "rgba(0, 0, 0, 0.8)", display: active === "none" ? active : "" }} 
            onClick={() => close_pop()}
        >
            <div className="popup-expire"
                onMouseOver={() => {
                    setActive_close(false)
                }}
                onMouseLeave={() => {
                    setActive_close(true)
                }}
            >
                <div className="popup-expire__body">
                    <div className="expire__body-title" style={{color: "black"}}>Your API keys are about to expire</div>
                    <div className="expire__body-text">Log in to your exchange account and prolong current API keys to continue trading period</div>
                    <div className="expire__body-icon" style={{display: 'flex', justifyContent: 'center'}}>
                        <svg width="91" height="98" viewBox="0 0 91 98" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M88.3716 17.56L89.4867 17.64V18.68C89.4867 19.64 89.5663 69.56 46.2389 95.4L45.6017 95.72L44.9645 95.4C1.71674 69.56 1.79639 19.64 1.79639 18.68V17.64L2.91143 17.56C13.2654 16.76 23.7787 13 31.6636 9.39996C35.6459 7.63996 38.9114 5.87996 41.3008 4.59996C42.4159 3.87996 43.3716 3.39996 44.0088 2.99996C44.6459 2.59996 45.0442 2.35996 45.0442 2.35996L45.6813 1.95996L46.3185 2.35996C46.3185 2.35996 46.7167 2.59996 47.3539 2.99996C47.9911 3.39996 48.9468 3.95996 50.0619 4.59996C52.3716 5.87996 55.7167 7.63996 59.699 9.39996C67.584 13 78.0176 16.76 88.3716 17.56Z" fill="white" stroke="#FD0707" strokeOpacity="0.5" strokeWidth="3" />
                            <path d="M38.8319 53.5601C41.6992 53.5601 43.4514 51.8801 43.4514 49.4001C43.4514 47.3201 42.0177 46.0401 40.0266 45.1601L38.6726 44.6001C37.1593 43.8801 36.5222 43.1601 36.5222 42.1201C36.5222 40.9201 37.6372 40.2001 38.8319 40.2001C39.5487 40.2001 40.1062 40.3601 40.5841 40.6801H43.0531C42.3363 39.4001 40.5841 38.3601 38.9116 38.3601C36.7611 38.3601 34.6107 39.8001 34.6107 42.1201C34.6107 43.9601 35.5664 45.4001 37.7965 46.3601L39.1505 46.9201C40.7434 47.6401 41.5399 48.3601 41.5399 49.7201C41.5399 51.0001 40.5045 51.8001 38.7523 51.8001C37.7965 51.8001 36.9204 51.4001 36.2036 50.8401H33.8142C34.6903 52.6001 36.6815 53.5601 38.8319 53.5601Z" fill="#2ECD99" />
                            <path d="M41.5398 54.6H44.0089L47.5929 49.8L50.3805 53.48H52.8496L48.8673 48.28L53.4071 42.2H50.9381L47.5929 46.68L43.6106 41.48H41.1416L46.2389 48.2L41.5398 54.6Z" fill="#2ECD99" />
                            <path d="M58.345 36.04L57.0707 37.48L53.4866 42.28H51.0176L55.7963 36.04L57.0707 34.52L60.4955 30.04H62.9645L58.345 36.04Z" fill="#2ECD99" />
                            <path d="M39.469 60.6001L38.1947 62.0401L34.6106 66.8401H32.1416L36.9204 60.6001L38.1947 59.0801L41.6195 54.6001H44.0089L39.469 60.6001Z" fill="#2ECD99" />
                            <path d="M69.3362 88.5999V76.9199H70.053V88.5199H69.3362V88.5999ZM71.4867 80.6799C71.407 80.2799 71.2477 79.9599 70.9292 79.7199C70.6106 79.4799 70.2123 79.3999 69.7345 79.3999C69.4159 79.3999 69.0973 79.4799 68.8584 79.5599C68.6194 79.6399 68.3805 79.7999 68.3008 79.9599C68.1415 80.1199 68.0619 80.3599 68.0619 80.5999C68.0619 80.7599 68.1415 80.9999 68.2212 81.0799C68.3008 81.2399 68.4601 81.3199 68.6194 81.4799C68.7787 81.5599 68.938 81.6399 69.0973 81.7199C69.2566 81.7999 69.4955 81.8799 69.6548 81.8799L70.5309 82.1199C70.8495 82.1999 71.2477 82.2799 71.5663 82.4399C71.8849 82.5999 72.2035 82.7599 72.4424 82.9999C72.6814 83.2399 72.9203 83.4799 73.0796 83.7999C73.2389 84.1199 73.3185 84.4399 73.3185 84.8399C73.3185 85.3999 73.1592 85.8799 72.9203 86.2799C72.6814 86.6799 72.2035 86.9999 71.7256 87.2399C71.1681 87.4799 70.6106 87.5599 69.8141 87.5599C69.0973 87.5599 68.4601 87.4799 67.9026 87.2399C67.3451 86.9999 66.9468 86.6799 66.6283 86.2799C66.3097 85.8799 66.1504 85.3199 66.1504 84.6799H67.823C67.823 84.9999 67.9822 85.2399 68.1415 85.4799C68.3008 85.7199 68.5398 85.8799 68.8584 85.9599C69.1769 86.0399 69.4955 86.1199 69.8141 86.1199C70.2123 86.1199 70.5309 86.0399 70.7699 85.9599C71.0088 85.8799 71.2477 85.7199 71.407 85.4799C71.5663 85.3199 71.646 85.0799 71.646 84.7599C71.646 84.5199 71.5663 84.2799 71.407 84.1199C71.2477 83.9599 71.0884 83.7999 70.8495 83.7199C70.6106 83.6399 70.292 83.4799 69.9734 83.3999L68.938 83.1599C68.1415 82.9999 67.584 82.6799 67.1061 82.2799C66.6283 81.8799 66.469 81.3199 66.469 80.6799C66.469 80.1199 66.6283 79.6399 66.9469 79.2399C67.2654 78.8399 67.6637 78.5199 68.1415 78.2799C68.6194 78.0399 69.2566 77.9599 69.8938 77.9599C70.5309 77.9599 71.0884 78.0399 71.646 78.2799C72.1238 78.5199 72.5221 78.8399 72.8407 79.2399C73.1592 79.6399 73.2389 80.1199 73.3185 80.5999H71.4867V80.6799Z" fill="white" />
                        </svg>
                    </div>
                    <div className="expire__body-btn">
                        <div className="dashboard-btn dashboard-btn-start " onClick={() => confirm()}>I will do it now</div>
                    </div>
                </div>
                <div className="popup-expire__aside" onClick={() => close()}>
                    <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="20" cy="20" r="20" fill="#FD0707" fillOpacity="0.5" />
                        <circle cx="20" cy="20" r="19.5" stroke="#FD0707" strokeOpacity="0.5" />
                        <path d="M20.8226 20.0001L24.4976 16.3309C24.6075 16.2211 24.6692 16.0721 24.6692 15.9168C24.6692 15.7614 24.6075 15.6125 24.4976 15.5026C24.3878 15.3928 24.2388 15.3311 24.0835 15.3311C23.9281 15.3311 23.7791 15.3928 23.6693 15.5026L20.0001 19.1776L16.331 15.5026C16.2211 15.3928 16.0721 15.3311 15.9168 15.3311C15.7615 15.3311 15.6125 15.3928 15.5026 15.5026C15.3928 15.6125 15.3311 15.7614 15.3311 15.9168C15.3311 16.0721 15.3928 16.2211 15.5026 16.3309L19.1776 20.0001L15.5026 23.6693C15.448 23.7235 15.4046 23.788 15.3749 23.8591C15.3453 23.9302 15.3301 24.0064 15.3301 24.0834C15.3301 24.1604 15.3453 24.2367 15.3749 24.3078C15.4046 24.3789 15.448 24.4434 15.5026 24.4976C15.5569 24.5523 15.6214 24.5957 15.6925 24.6253C15.7635 24.6549 15.8398 24.6702 15.9168 24.6702C15.9938 24.6702 16.07 24.6549 16.1411 24.6253C16.2122 24.5957 16.2767 24.5523 16.331 24.4976L20.0001 20.8226L23.6693 24.4976C23.7235 24.5523 23.788 24.5957 23.8591 24.6253C23.9302 24.6549 24.0065 24.6702 24.0835 24.6702C24.1605 24.6702 24.2367 24.6549 24.3078 24.6253C24.3789 24.5957 24.4434 24.5523 24.4976 24.4976C24.5523 24.4434 24.5957 24.3789 24.6253 24.3078C24.6549 24.2367 24.6702 24.1604 24.6702 24.0834C24.6702 24.0064 24.6549 23.9302 24.6253 23.8591C24.5957 23.788 24.5523 23.7235 24.4976 23.6693L20.8226 20.0001Z" fill="white" stroke="white" strokeWidth="0.5" />
                    </svg>
                </div>
            </div>
        </div>
    )
}